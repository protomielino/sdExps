INCLUDE(../../cmake/macros.cmake)

PROJECT(speed-dreams-2)

SET(_TARGET_NAME speed-dreams-2)

SET(_SOURCES main.cpp)
IF(WIN32)
    SET(_SOURCES ${_SOURCES} main.rc resource.h ../../data/data/icons/icon.ico)
ENDIF(WIN32)

ADD_INTERFACE_INCLUDEDIR()
ADD_SDLIB_INCLUDEDIR(tgf tgfclient tgfdata raceengine math portability)
ADD_PLIB_INCLUDEDIR()

# Disable developer warning
IF(COMMAND CMAKE_POLICY)
    CMAKE_POLICY(SET CMP0003 NEW)
ENDIF(COMMAND CMAKE_POLICY)

ADD_EXECUTABLE(${_TARGET_NAME} ${_SOURCES})

ADD_SDLIB_LIBRARY(${_TARGET_NAME} tgf tgfclient tgfdata raceengine)
IF(LINUX)
    ADD_DL_LIBRARY(${_TARGET_NAME})
ENDIF(LINUX)

SD_INSTALL_FILES(BIN TARGETS ${_TARGET_NAME})

# Under Windows, install OpenAL and SDL DLLs close to Speed Dreams executable
IF(WIN32)

    FIND_PACKAGE(OpenAL)
    GET_FILENAME_COMPONENT(_OPENALLIBPATH ${OPENAL_LIBRARY} PATH)
    GET_FILENAME_COMPONENT(_OPENALLIBNAME ${OPENAL_LIBRARY} NAME_WE)
    SET(_OPENALDLLPATHNAME ${_OPENALLIBPATH}/../bin/${CMAKE_SHARED_LIBRARY_PREFIX}${_OPENALLIBNAME}${CMAKE_SHARED_LIBRARY_SUFFIX})

    FIND_PACKAGE(SDL)
    GET_FILENAME_COMPONENT(_SDLLIBPATH ${SDL_LIBRARY} PATH)
    GET_FILENAME_COMPONENT(_SDLLIBNAME ${SDL_LIBRARY} NAME_WE)
    SET(_SDLDLLPATHNAME ${_SDLLIBPATH}/../bin/${CMAKE_SHARED_LIBRARY_PREFIX}${_SDLLIBNAME}${CMAKE_SHARED_LIBRARY_SUFFIX})

    SD_INSTALL_FILES(BIN FILES ${_OPENALDLLPATHNAME} ${_SDLDLLPATHNAME})

ENDIF(WIN32)
